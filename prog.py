import random
import subprocess
import tkinter as tk
from tkinter import ttk
from pyfiglet import Figlet
from extractPE import fileExtract
from malwareML import machineLearnMalware
from spamML import machineLearnSpam
from urlML import machineLearnUrl

def display_title():
    title_text = "EASY\nMalware\nAnalyzer"
    font = ("Comic Sans MS", 40, "bold")
    title_label.config(font=font, justify="center", wraplength=300)  # Adjust the wraplength as needed
    title_label.config(background="dark green", foreground="black")  # Set the background and foreground color

    title_lines = title_text.split("\n")
    title_label.config(text='\n'.join(title_lines), anchor="n")

def show_malware_analysis():
    hide_main_menu()
    clear_input()
    show_main_menu_button()
    
    malware_path_label.grid(column=0, row=1)
    malware_path_entry.grid(column=1, row=1)
    malware_ok_button.grid(column=2, row=1)

def show_url_analysis():
    hide_main_menu()
    clear_input()
    show_main_menu_button()
    
    url_label.grid(column=0, row=1)
    url_entry.grid(column=1, row=1)
    url_ok_button.grid(column=2, row=1)

def show_email_analysis():
    hide_main_menu()
    clear_input()
    show_main_menu_button()
    
    email_label.grid(column=0, row=1)
    email_entry.grid(column=1, row=1, columnspan=2)  # Extend the email entry across columns 1 and 2
    email_ok_button.grid(column=3, row=1)

def show_main_menu_button():
    main_menu_button.grid(column=0, row=2, columnspan=4)

def clear_input():
    main_menu_button.grid_forget()
    malware_path_label.grid_forget()
    malware_path_entry.grid_forget()
    malware_ok_button.grid_forget()
    url_label.grid_forget()
    url_entry.grid_forget()
    url_ok_button.grid_forget()
    email_label.grid_forget()
    email_entry.grid_forget()
    email_ok_button.grid_forget()

def return_to_main_menu():
    clear_input()
    hide_result()
    show_main_menu()

def malware_analysis():
    exe_path = malware_path_entry.get()
    fileExtract(exe_path)
    result = machineLearnMalware()
    show_result("ML Prediction --> Malware." if result >= 2 else "ML Prediction --> Secure.")

def url_analysis():
    url = url_entry.get()
    result = machineLearnUrl(url)
    show_result("ML Prediction --> Spam." if result >= 2 else "ML Prediction --> Secure.")

def email_analysis():
    message = email_entry.get()
    result = machineLearnSpam(message)
    show_result("ML Prediction --> Spam." if result >= 2 else "ML Prediction --> Secure.")

def show_result(text):
    result_label.config(text=text)
    result_label.grid(column=0, row=3, columnspan=4)

def hide_result():
    result_label.grid_forget()

def show_main_menu():
    show_main_menu_button()
    malware_button.grid(column=0, row=1)
    url_button.grid(column=1, row=1)
    email_button.grid(column=2, row=1)
    exit_button.grid(column=3, row=1)

def hide_main_menu():
    main_menu_button.grid_forget()
    malware_button.grid_forget()
    url_button.grid_forget()
    email_button.grid_forget()
    exit_button.grid_forget()

root = tk.Tk()
root.title('EASY Malware Analyzer')

# Create a black frame as the outer container
main_frame = tk.Frame(root, background="black")
main_frame.grid(column=0, row=0)

# Create a frame for your content with dark green background
content_frame = ttk.Frame(main_frame, style="Main.TFrame")
content_frame.grid(column=0, row=0)

# Create the title label
title_label = ttk.Label(content_frame)
title_label.grid(column=0, row=0, columnspan=4)
display_title()

# Main menu buttons
malware_button = ttk.Button(content_frame, text="Malware Analysis", command=show_malware_analysis, style='MainMenu.TButton')
url_button = ttk.Button(content_frame, text="URL Analysis", command=show_url_analysis, style='MainMenu.TButton')
email_button = ttk.Button(content_frame, text="Email Analysis", command=show_email_analysis, style='MainMenu.TButton')
exit_button = ttk.Button(content_frame, text="Exit", command=root.quit, style='Exit.TButton')
main_menu_button = ttk.Button(content_frame, text="Main Menu", command=return_to_main_menu, style='MainMenu.TButton')

# Entry fields and OK buttons for different analyses
malware_path_label = ttk.Label(content_frame, text="Enter the path to the executable file:", style='Label.TLabel')
malware_path_entry = ttk.Entry(content_frame, style='Entry.TEntry')
malware_ok_button = ttk.Button(content_frame, text="OK", command=malware_analysis, style='OK.TButton')

url_label = ttk.Label(content_frame, text="Enter the URL for analysis:", style='Label.TLabel')
url_entry = ttk.Entry(content_frame, style='Entry.TEntry')
url_ok_button = ttk.Button(content_frame, text="OK", command=url_analysis, style='OK.TButton')

email_label = ttk.Label(content_frame, text="Enter the email/message for analysis:", style='Label.TLabel')
email_entry = ttk.Entry(content_frame, style='Entry.TEntry')
email_ok_button = ttk.Button(content_frame, text="OK", command=email_analysis, style='OK.TButton')

# Result label
result_label = ttk.Label(content_frame, text="", style='Result.TLabel')

show_main_menu()

# Create styles for elements
style = ttk.Style()
style.configure('MainMenu.TButton', background='lightblue', foreground='black', font=('Helvetica', 12, 'bold'))
style.configure('OK.TButton', background='dark green', foreground='red', font=('Helvetica', 12, 'bold'))  # Change foreground to red
style.configure('Exit.TButton', background='dark green', foreground='red', font=('Helvetica', 12, 'bold'))  # Change foreground to red
style.configure('Label.TLabel', background='lightgray', foreground='black', font=('Helvetica', 12, 'bold'))
style.configure('Entry.TEntry', background='white', foreground='black', font=('Helvetica', 12, 'bold'))
style.configure('Result.TLabel', background='yellow', foreground='black', font=('Helvetica', 12, 'bold'))
style.configure('Main.TFrame', background='dark green')  # Set the background color of the main content frame

root.mainloop()
